{"ast":null,"code":"import{D3_TRANSITION_DURATION,MAP_LEGEND_HEIGHT,MAP_VIZS}from'../constants';import{useResizeObserver}from'../hooks/useResizeObserver';import{capitalize,formatNumber}from'../utils/commonFunctions';import{range,quantile}from'd3-array';import{axisRight,axisBottom}from'd3-axis';import{format}from'd3-format';import{interpolate,interpolateRound,quantize}from'd3-interpolate';import{scaleLinear,scaleOrdinal,scaleBand}from'd3-scale';import{select}from'd3-selection';import React,{useEffect,useRef}from'react';import{useTranslation}from'react-i18next';function MapLegend(_ref){var data=_ref.data,mapViz=_ref.mapViz,mapScale=_ref.mapScale,statistic=_ref.statistic;var _useTranslation=useTranslation(),t=_useTranslation.t;var svgRef=useRef(null);var wrapperRef=useRef();var dimensions=useResizeObserver(wrapperRef);useEffect(function(){var svg=select(svgRef.current);var _ref2=dimensions||wrapperRef.current.getBoundingClientRect(),width=_ref2.width,height=_ref2.height;if(!width||!height){var _wrapperRef$current$g=wrapperRef.current.getBoundingClientRect();width=_wrapperRef$current$g.width;height=_wrapperRef$current$g.height;}if(!width||!height)return;if(mapViz===MAP_VIZS.BUBBLES){var _t=svg.transition().duration(D3_TRANSITION_DURATION);svg.select('.ramp').transition(_t).attr('opacity',0).attr('xlink:href',null);svg.select('.bars').selectAll('rect').transition(_t).attr('opacity',0).remove();svg.selectAll('.axis > *:not(.axistext)').remove();svg.select('.axistext').text('');var domainMax=mapScale.domain()[1];var _legend=svg.select('.circles').attr('transform',\"translate(48,40)\").attr('text-anchor','middle');_legend.selectAll('circle').data([domainMax/10,domainMax*2/5,domainMax]).join('circle').attr('fill','none').attr('stroke','#ccc').transition(_t).attr('cy',function(d){return-mapScale(d);}).attr('r',mapScale);var yScale=mapScale.copy().range([0,-2*mapScale(domainMax)]);svg.select('.circleAxis').attr('transform',\"translate(48,50)\").transition(_t).call(axisRight(yScale).tickSize(0).tickPadding(0).tickValues([domainMax/10,domainMax*2/5,domainMax]).tickFormat(function(num){return formatNumber(num,'short');})).selectAll('.tick text').style('text-anchor','middle');svg.select('.circleAxis').call(function(g){return g.select('.domain').remove();});}else{svg.call(function(){return legend({svg:svg,color:mapScale,title:\"\".concat(t(capitalize(statistic)),\" \").concat(t('cases')),width:width,height:height,ticks:5,tickFormat:function tickFormat(d,i,n){if(mapViz===MAP_VIZS.CHOROPLETH&&!Number.isInteger(d))return;if(i===n.length-1)return formatNumber(d)+'+';return formatNumber(d);},marginLeft:2,marginRight:0});});}},[t,dimensions,mapScale,mapViz,statistic]);return/*#__PURE__*/React.createElement(\"div\",{className:\"svg-parent maplegend\",style:{height:MAP_LEGEND_HEIGHT},ref:wrapperRef},/*#__PURE__*/React.createElement(\"svg\",{id:\"legend\",preserveAspectRatio:\"xMidYMid meet\",ref:svgRef},/*#__PURE__*/React.createElement(\"image\",{className:\"ramp\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"bars\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"circles\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"circleAxis\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"axis\"},/*#__PURE__*/React.createElement(\"text\",{className:\"axistext\"}))),/*#__PURE__*/React.createElement(\"canvas\",{className:\"color-scale\",style:{position:'absolute',height:0}}));}export default MapLegend;function legend(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},svg=_ref3.svg,color=_ref3.color,title=_ref3.title,_ref3$tickSize=_ref3.tickSize,tickSize=_ref3$tickSize===void 0?6:_ref3$tickSize,_ref3$width=_ref3.width,width=_ref3$width===void 0?320:_ref3$width,_ref3$height=_ref3.height,height=_ref3$height===void 0?44+tickSize:_ref3$height,_ref3$marginTop=_ref3.marginTop,marginTop=_ref3$marginTop===void 0?18:_ref3$marginTop,_ref3$marginRight=_ref3.marginRight,marginRight=_ref3$marginRight===void 0?0:_ref3$marginRight,_ref3$marginBottom=_ref3.marginBottom,marginBottom=_ref3$marginBottom===void 0?16+tickSize:_ref3$marginBottom,_ref3$marginLeft=_ref3.marginLeft,marginLeft=_ref3$marginLeft===void 0?0:_ref3$marginLeft,_ref3$ticks=_ref3.ticks,ticks=_ref3$ticks===void 0?width/64:_ref3$ticks,tickFormat=_ref3.tickFormat,tickValues=_ref3.tickValues,ordinalWeights=_ref3.ordinalWeights;svg.selectAll('.circles > *').remove();svg.selectAll('.circleAxis > *').remove();var t=svg.transition().duration(D3_TRANSITION_DURATION);var tickAdjust=function tickAdjust(g){var ticks=g.selectAll('.tick line');ticks.attr('y1',marginTop+marginBottom-height);// select(ticks.nodes()[ticks.size() - 1]).remove();\n};var x;// Continuous\nif(color.interpolate){var n=Math.min(color.domain().length,color.range().length);x=color.copy().rangeRound(quantize(interpolate(marginLeft,width-marginRight),n));svg.select('.ramp').attr('class','ramp').attr('x',marginLeft).attr('y',marginTop).attr('width',width-marginLeft-marginRight).attr('height',height-marginTop-marginBottom).attr('preserveAspectRatio','none').attr('xlink:href',ramp(color.copy().domain(quantize(interpolate(0,1),n))).toDataURL());}// Sequential\nelse if(color.interpolator){svg.select('.bars').selectAll('rect').transition(t).attr('opacity',0).remove();x=Object.assign(color.copy().interpolator(interpolateRound(marginLeft,width-marginRight)),{range:function range(){return[marginLeft,width-marginRight];}});svg.select('.ramp').attr('class','ramp').attr('x',marginLeft).attr('y',marginTop).attr('width',width-marginLeft-marginRight).attr('height',height-marginTop-marginBottom).attr('preserveAspectRatio','none').attr('xlink:href',ramp(color.interpolator()).toDataURL()).transition(t).attr('opacity',1);// scaleSequentialQuantile doesn’t implement ticks or tickFormat.\nif(!x.ticks){if(tickValues===undefined){var _n=Math.round(ticks+1);tickValues=range(_n).map(function(i){return quantile(color.domain(),i/(_n-1));});}if(typeof tickFormat!=='function'){tickFormat=format(tickFormat===undefined?',f':tickFormat);}}}// Threshold\nelse if(color.invertExtent){var thresholds=color.thresholds?color.thresholds()// scaleQuantize\n:color.quantiles?color.quantiles()// scaleQuantile\n:color.domain();// scaleThreshold\nvar thresholdFormat=tickFormat===undefined?function(d){return d;}:typeof tickFormat==='string'?format(tickFormat):tickFormat;x=scaleLinear().domain([-1,color.range().length-1]).rangeRound([marginLeft,width-marginRight]);svg.append('g').selectAll('rect').data(color.range()).join('rect').attr('x',function(d,i){return x(i-1);}).attr('y',marginTop).attr('width',function(d,i){return x(i)-x(i-1);}).attr('height',height-marginTop-marginBottom).attr('fill',function(d){return d;});tickValues=range(-1,thresholds.length);tickFormat=function tickFormat(i){if(i===-1)return thresholdFormat(1);else if(i===thresholds.length-1)return;else if(i===thresholds.length-2)return thresholdFormat(thresholds[i]+'+',i);return thresholdFormat(thresholds[i],i);};}// Ordinal\nelse{svg.select('.ramp').transition(t).attr('opacity',0).attr('xlink:href',null);if(!ordinalWeights){x=scaleBand().domain(color.domain()).rangeRound([marginLeft,width-marginRight]);svg.selectAll('rect').data(color.domain()).join('rect').attr('x',x).attr('y',marginTop).attr('width',Math.max(0,x.bandwidth()-1)).attr('height',height-marginTop-marginBottom).attr('fill',color);}else{var widthScale=scaleLinear().domain([0,ordinalWeights.reduce(function(a,b){return a+b;})]).rangeRound([0,width-marginLeft-marginRight]);var xPos=ordinalWeights.map(function(w,i){return ordinalWeights.slice(0,i).reduce(function(acc,w){return acc+widthScale(w);},marginLeft);});x=scaleOrdinal().domain(color.domain()).range(xPos);svg.select('.bars').selectAll('rect').data(color.domain()).join(function(enter){return enter.append('rect').attr('x',x).attr('width',function(d,i){return widthScale(ordinalWeights[i]);});}).attr('y',marginTop).attr('height',height-marginTop-marginBottom).attr('fill',color).transition(t).attr('x',x).attr('width',function(d,i){return widthScale(ordinalWeights[i]);}).attr('opacity',1);}tickAdjust=function tickAdjust(){};}svg.select('.axis').attr('transform',\"translate(0,\".concat(height-marginBottom,\")\")).transition(t).attr('class','axis').call(axisBottom(x).ticks(ticks,typeof tickFormat==='string'?tickFormat:undefined).tickFormat(typeof tickFormat==='function'?tickFormat:undefined).tickSize(tickSize).tickValues(tickValues)).on('start',function(){svg.call(tickAdjust).call(function(svg){return svg.select('.domain').remove();});}).call(function(g){return g.select('.axistext').attr('class','axistext').attr('x',marginLeft).attr('y',marginTop+marginBottom-height-6).attr('fill','currentColor').attr('text-anchor','start').attr('font-weight','bold').text(title);});return svg.node();}function ramp(color){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:256;// const canvas = document.createElement('canvas');\nvar canvas=select('.color-scale').node();var context=(canvas.width=n,canvas.height=1,canvas).getContext('2d');for(var i=0;i<n;++i){context.fillStyle=color(i/(n-1));context.fillRect(i,0,1,1);}return canvas;}","map":{"version":3,"sources":["/home/ubuntu/myprojectdir/tracker/covid19india-react/src/components/MapLegend.js"],"names":["D3_TRANSITION_DURATION","MAP_LEGEND_HEIGHT","MAP_VIZS","useResizeObserver","capitalize","formatNumber","range","quantile","axisRight","axisBottom","format","interpolate","interpolateRound","quantize","scaleLinear","scaleOrdinal","scaleBand","select","React","useEffect","useRef","useTranslation","MapLegend","data","mapViz","mapScale","statistic","t","svgRef","wrapperRef","dimensions","svg","current","getBoundingClientRect","width","height","BUBBLES","transition","duration","attr","selectAll","remove","text","domainMax","domain","legend","join","d","yScale","copy","call","tickSize","tickPadding","tickValues","tickFormat","num","style","g","color","title","ticks","i","n","CHOROPLETH","Number","isInteger","length","marginLeft","marginRight","position","marginTop","marginBottom","ordinalWeights","tickAdjust","x","Math","min","rangeRound","ramp","toDataURL","interpolator","Object","assign","undefined","round","map","invertExtent","thresholds","quantiles","thresholdFormat","append","max","bandwidth","widthScale","reduce","a","b","xPos","w","slice","acc","enter","on","node","canvas","context","getContext","fillStyle","fillRect"],"mappings":"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","sourcesContent":["import {\n  D3_TRANSITION_DURATION,\n  MAP_LEGEND_HEIGHT,\n  MAP_VIZS,\n} from '../constants';\nimport {useResizeObserver} from '../hooks/useResizeObserver';\nimport {capitalize, formatNumber} from '../utils/commonFunctions';\n\nimport {range, quantile} from 'd3-array';\nimport {axisRight, axisBottom} from 'd3-axis';\nimport {format} from 'd3-format';\nimport {interpolate, interpolateRound, quantize} from 'd3-interpolate';\nimport {scaleLinear, scaleOrdinal, scaleBand} from 'd3-scale';\nimport {select} from 'd3-selection';\nimport React, {useEffect, useRef} from 'react';\nimport {useTranslation} from 'react-i18next';\n\nfunction MapLegend({data, mapViz, mapScale, statistic}) {\n  const {t} = useTranslation();\n\n  const svgRef = useRef(null);\n  const wrapperRef = useRef();\n  const dimensions = useResizeObserver(wrapperRef);\n\n  useEffect(() => {\n    const svg = select(svgRef.current);\n    let {width, height} =\n      dimensions || wrapperRef.current.getBoundingClientRect();\n\n    if (!width || !height)\n      ({width, height} = wrapperRef.current.getBoundingClientRect());\n\n    if (!width || !height) return;\n\n    if (mapViz === MAP_VIZS.BUBBLES) {\n      const t = svg.transition().duration(D3_TRANSITION_DURATION);\n      svg\n        .select('.ramp')\n        .transition(t)\n        .attr('opacity', 0)\n        .attr('xlink:href', null);\n\n      svg\n        .select('.bars')\n        .selectAll('rect')\n        .transition(t)\n        .attr('opacity', 0)\n        .remove();\n      svg.selectAll('.axis > *:not(.axistext)').remove();\n      svg.select('.axistext').text('');\n\n      const domainMax = mapScale.domain()[1];\n\n      const legend = svg\n        .select('.circles')\n        .attr('transform', `translate(48,40)`)\n        .attr('text-anchor', 'middle');\n\n      legend\n        .selectAll('circle')\n        .data([domainMax / 10, (domainMax * 2) / 5, domainMax])\n        .join('circle')\n        .attr('fill', 'none')\n        .attr('stroke', '#ccc')\n        .transition(t)\n        .attr('cy', (d) => -mapScale(d))\n        .attr('r', mapScale);\n\n      const yScale = mapScale.copy().range([0, -2 * mapScale(domainMax)]);\n\n      svg\n        .select('.circleAxis')\n        .attr('transform', `translate(48,50)`)\n        .transition(t)\n        .call(\n          axisRight(yScale)\n            .tickSize(0)\n            .tickPadding(0)\n            .tickValues([domainMax / 10, (domainMax * 2) / 5, domainMax])\n            .tickFormat((num) => formatNumber(num, 'short'))\n        )\n        .selectAll('.tick text')\n        .style('text-anchor', 'middle');\n\n      svg.select('.circleAxis').call((g) => g.select('.domain').remove());\n    } else {\n      svg.call(() =>\n        legend({\n          svg: svg,\n          color: mapScale,\n          title: `${t(capitalize(statistic))} ${t('cases')}`,\n          width: width,\n          height: height,\n          ticks: 5,\n          tickFormat: function (d, i, n) {\n            if (mapViz === MAP_VIZS.CHOROPLETH && !Number.isInteger(d)) return;\n            if (i === n.length - 1) return formatNumber(d) + '+';\n            return formatNumber(d);\n          },\n          marginLeft: 2,\n          marginRight: 0,\n        })\n      );\n    }\n  }, [t, dimensions, mapScale, mapViz, statistic]);\n\n  return (\n    <div\n      className=\"svg-parent maplegend\"\n      style={{height: MAP_LEGEND_HEIGHT}}\n      ref={wrapperRef}\n    >\n      <svg id=\"legend\" preserveAspectRatio=\"xMidYMid meet\" ref={svgRef}>\n        <image className=\"ramp\" />\n        <g className=\"bars\"></g>\n        <g className=\"circles\"></g>\n        <g className=\"circleAxis\"></g>\n        <g className=\"axis\">\n          <text className=\"axistext\" />\n        </g>\n      </svg>\n      <canvas\n        className=\"color-scale\"\n        style={{position: 'absolute', height: 0}}\n      />\n    </div>\n  );\n}\n\nexport default MapLegend;\n\nfunction legend({\n  svg,\n  color,\n  title,\n  tickSize = 6,\n  width = 320,\n  height = 44 + tickSize,\n  marginTop = 18,\n  marginRight = 0,\n  marginBottom = 16 + tickSize,\n  marginLeft = 0,\n  ticks = width / 64,\n  tickFormat,\n  tickValues,\n  ordinalWeights,\n} = {}) {\n  svg.selectAll('.circles > *').remove();\n  svg.selectAll('.circleAxis > *').remove();\n  const t = svg.transition().duration(D3_TRANSITION_DURATION);\n\n  let tickAdjust = (g) => {\n    const ticks = g.selectAll('.tick line');\n    ticks.attr('y1', marginTop + marginBottom - height);\n    // select(ticks.nodes()[ticks.size() - 1]).remove();\n  };\n  let x;\n\n  // Continuous\n  if (color.interpolate) {\n    const n = Math.min(color.domain().length, color.range().length);\n\n    x = color\n      .copy()\n      .rangeRound(quantize(interpolate(marginLeft, width - marginRight), n));\n\n    svg\n      .select('.ramp')\n      .attr('class', 'ramp')\n      .attr('x', marginLeft)\n      .attr('y', marginTop)\n      .attr('width', width - marginLeft - marginRight)\n      .attr('height', height - marginTop - marginBottom)\n      .attr('preserveAspectRatio', 'none')\n      .attr(\n        'xlink:href',\n        ramp(color.copy().domain(quantize(interpolate(0, 1), n))).toDataURL()\n      );\n  }\n\n  // Sequential\n  else if (color.interpolator) {\n    svg\n      .select('.bars')\n      .selectAll('rect')\n      .transition(t)\n      .attr('opacity', 0)\n      .remove();\n\n    x = Object.assign(\n      color\n        .copy()\n        .interpolator(interpolateRound(marginLeft, width - marginRight)),\n      {\n        range() {\n          return [marginLeft, width - marginRight];\n        },\n      }\n    );\n\n    svg\n      .select('.ramp')\n      .attr('class', 'ramp')\n      .attr('x', marginLeft)\n      .attr('y', marginTop)\n      .attr('width', width - marginLeft - marginRight)\n      .attr('height', height - marginTop - marginBottom)\n      .attr('preserveAspectRatio', 'none')\n      .attr('xlink:href', ramp(color.interpolator()).toDataURL())\n      .transition(t)\n      .attr('opacity', 1);\n\n    // scaleSequentialQuantile doesn’t implement ticks or tickFormat.\n    if (!x.ticks) {\n      if (tickValues === undefined) {\n        const n = Math.round(ticks + 1);\n        tickValues = range(n).map((i) => quantile(color.domain(), i / (n - 1)));\n      }\n      if (typeof tickFormat !== 'function') {\n        tickFormat = format(tickFormat === undefined ? ',f' : tickFormat);\n      }\n    }\n  }\n\n  // Threshold\n  else if (color.invertExtent) {\n    const thresholds = color.thresholds\n      ? color.thresholds() // scaleQuantize\n      : color.quantiles\n      ? color.quantiles() // scaleQuantile\n      : color.domain(); // scaleThreshold\n\n    const thresholdFormat =\n      tickFormat === undefined\n        ? (d) => d\n        : typeof tickFormat === 'string'\n        ? format(tickFormat)\n        : tickFormat;\n\n    x = scaleLinear()\n      .domain([-1, color.range().length - 1])\n      .rangeRound([marginLeft, width - marginRight]);\n\n    svg\n      .append('g')\n      .selectAll('rect')\n      .data(color.range())\n      .join('rect')\n      .attr('x', (d, i) => x(i - 1))\n      .attr('y', marginTop)\n      .attr('width', (d, i) => x(i) - x(i - 1))\n      .attr('height', height - marginTop - marginBottom)\n      .attr('fill', (d) => d);\n\n    tickValues = range(-1, thresholds.length);\n    tickFormat = (i) => {\n      if (i === -1) return thresholdFormat(1);\n      else if (i === thresholds.length - 1) return;\n      else if (i === thresholds.length - 2)\n        return thresholdFormat(thresholds[i] + '+', i);\n      return thresholdFormat(thresholds[i], i);\n    };\n  }\n\n  // Ordinal\n  else {\n    svg\n      .select('.ramp')\n      .transition(t)\n      .attr('opacity', 0)\n      .attr('xlink:href', null);\n    if (!ordinalWeights) {\n      x = scaleBand()\n        .domain(color.domain())\n        .rangeRound([marginLeft, width - marginRight]);\n      svg\n        .selectAll('rect')\n        .data(color.domain())\n        .join('rect')\n        .attr('x', x)\n        .attr('y', marginTop)\n        .attr('width', Math.max(0, x.bandwidth() - 1))\n        .attr('height', height - marginTop - marginBottom)\n        .attr('fill', color);\n    } else {\n      const widthScale = scaleLinear()\n        .domain([0, ordinalWeights.reduce((a, b) => a + b)])\n        .rangeRound([0, width - marginLeft - marginRight]);\n\n      const xPos = ordinalWeights.map((w, i) =>\n        ordinalWeights\n          .slice(0, i)\n          .reduce((acc, w) => acc + widthScale(w), marginLeft)\n      );\n\n      x = scaleOrdinal().domain(color.domain()).range(xPos);\n\n      svg\n        .select('.bars')\n        .selectAll('rect')\n        .data(color.domain())\n        .join((enter) =>\n          enter\n            .append('rect')\n            .attr('x', x)\n            .attr('width', (d, i) => widthScale(ordinalWeights[i]))\n        )\n        .attr('y', marginTop)\n        .attr('height', height - marginTop - marginBottom)\n        .attr('fill', color)\n        .transition(t)\n        .attr('x', x)\n        .attr('width', (d, i) => widthScale(ordinalWeights[i]))\n        .attr('opacity', 1);\n    }\n\n    tickAdjust = () => {};\n  }\n\n  svg\n    .select('.axis')\n    .attr('transform', `translate(0,${height - marginBottom})`)\n    .transition(t)\n    .attr('class', 'axis')\n    .call(\n      axisBottom(x)\n        .ticks(ticks, typeof tickFormat === 'string' ? tickFormat : undefined)\n        .tickFormat(typeof tickFormat === 'function' ? tickFormat : undefined)\n        .tickSize(tickSize)\n        .tickValues(tickValues)\n    )\n    .on('start', () => {\n      svg.call(tickAdjust).call((svg) => svg.select('.domain').remove());\n    })\n    .call((g) =>\n      g\n        .select('.axistext')\n        .attr('class', 'axistext')\n        .attr('x', marginLeft)\n        .attr('y', marginTop + marginBottom - height - 6)\n        .attr('fill', 'currentColor')\n        .attr('text-anchor', 'start')\n        .attr('font-weight', 'bold')\n        .text(title)\n    );\n\n  return svg.node();\n}\n\nfunction ramp(color, n = 256) {\n  // const canvas = document.createElement('canvas');\n  const canvas = select('.color-scale').node();\n  const context = ((canvas.width = n), (canvas.height = 1), canvas).getContext(\n    '2d'\n  );\n  for (let i = 0; i < n; ++i) {\n    context.fillStyle = color(i / (n - 1));\n    context.fillRect(i, 0, 1, 1);\n  }\n  return canvas;\n}\n"]},"metadata":{},"sourceType":"module"}